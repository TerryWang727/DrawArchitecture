```
设计微博系统中”微博评论“的高性能高可用计算架构。
【作业要求】
基于模块5第6课的微博实战案例，分析“微博评论”这个核心场景的业务特性，然后设计其
高性能高可用计算架构，包括但不限于如下内容：
1. 计算性能预估（不需要考虑存储性能）；
2. 非热点事件时的高性能计算架构，需要考虑是否要拆分独立的服务；
3. 热点事件时的高可用计算架构。
【提示】
1. 分析方法对照“看微博”和“发微博”的案例。
```

```
微博评论高可用计算架构
一、业务场景性能估算
微博发布2022年第一季财报。财报显示微博2022年3月的月活跃用户数为5.82亿人，同比净增约5100万名用户。微博当前的月活人数已经为5.82亿人，日均活跃用户数已经为2.51亿人。

假设平均峰值时间为吃饭时间，中午11:00-13:00，晚上17:00-19:00，假定这几个时间操作量占比为总日活的60%。

假设一条微博平均浏览量为150，其中50个用户会浏览前10条评论，则每天观看评论数约为2.51亿*50*10，平均qps为：1250亿*0.6/4/3600约为520万/s

假设发评论为看评论的25% 则平均qps 520*0.25约为130万/秒

业务特性分析
微博评论是一个典型的写操作，因此不能用缓存，可以用负载均衡。
架构分析
用户量过亿，应该要用多级负载均衡架构，覆盖 DNS -> F5/LVS -> Nginx集群 -> 网关集群的多级负载均衡。

二架构设计
1.负载均衡算法选择
微博评论的时候依赖登录状态，登录状态一般都是保存在分布式缓存中的，因此评论微博的时候，将请求发送给任意服务器都可以，这里选择“轮询”或者“随机”算法。
2. 业务服务器数量估算微博评论涉及几个交互业务系统：内容审核、数据写入存储、写入缓存，因此按照一个服务（4c8G）每秒处理500来估算，完成1300k/s的 TPS，需要2600台服务器，加上灾备服务器，约为3000台服务器。

二、非热点事件时高可用架构
第一级负载均衡由DNS到F5/LVS
二级负载均衡由F5/LVS到Nginx集群
三级负载均衡 使用轮询或随机算法 从Nginx集群到网关集群
四级负载均衡由服务网关集群到服务集群同样使用轮询或随机算法分配
网关集群和服务集群统一通过服务注册发现集群实现服务治理

图为简化每个都是集群并非一台单机 如F5n台之间心跳保活等细节省略
![image](https://user-images.githubusercontent.com/66302357/186701109-597e76a3-6a9f-4c27-aa95-86ecf4d86fac.png)

三、热点事件时高可用架构
```

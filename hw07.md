```
作业：王者荣耀商城异地多活架构设计
【背景】
假设现在决定要实现王者荣耀里面的商城的异地多活架构，请你分析设计一下。
【作业要求】
1.分析王者荣耀商城的业务特点，设计其异地多活架构；2.按照模块7第5课的方法来设计异地多活架构。
【提示】
1.王者荣耀的商城是虚拟物品商城，和淘宝这种实物电商有两个很大的区别，注意识别出来；2.用户要先调用微信钱包或者QQ钱包充值点券，然后在商城里面用点券支付；
3.用户买英雄和皮肤的时候同样的英雄和皮肤只能买1个，不能重复购买；
4.用户买鲜花、改名卡之类的道具可以买多个；
5.分析步骤参考模块7第6课的案例。
```


```
设计步骤
一、业务分级
根据对用户使用交互以及价值的重要程度，王者荣耀商城需要保障异地多活的业务:订单、充值、账号点券及库存

二、数据分类
1、用户uid：登录后唯一
2、点券余额：一致性要求较高，且不能够丢失
3、物品库存：数据是强一致性的
4、订单 ID：每次新建，全局唯一，不会修改。
5、订单数据：和订单 ID 绑定，例如 用户信息、商品名称、商品价格等。

三、数据同步
1、用户uid：数据库同步
2、点券余额：根据用户id获取，数据是强一致性的，数据库同步
3、物品库存：根据用户id获取，数据是强一致性的，数据库同步
4、订单 ID：数据库同步
5、订单数据：订单 ID 绑定，数据库同步

四、异常处理
1、点券消耗之后，购买皮肤/荣耀积分未到账
系统恢复后发放。
2、点券购买道具后出现重复扣款
退还重复扣款点券。
3、优惠券使用异常，没有正常产生折扣
退还该用户可用最大优惠券等额点券。
4、魔法球/抽奖系统奖励异常
将暂时对该系统进行维护，暂时关闭入口，在修复完成后再次打开。
```

```
异地多活架构图
区服数据库和商场数据库都按区互为主备进行数据同步
https://www.processon.com/view/link/632360ee1efad46b0aafe37e
```
